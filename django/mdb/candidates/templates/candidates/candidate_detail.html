{% extends "base.html" %}


{% block content %}

<div class="page-header">
  <h1>{{ candidate.name_ballot }} <small>{{ candidate.number }}</small></h1>
</div>

<div class="panel panel-default">
<!-- Default panel contents -->
    <div class="panel-heading">
        <h3 class="panel-title">Perfil</h3>
    </div>
    <div class="panel-body">

        <div class="media">
            <div class="media-left media-top">
                <a href="#">
                <img class="media-object" src="{{ candidate.picture_url }}">
                </a>
            </div>
            <div class="media-body">
                <h4 class="media-heading">{{ candidate.name }}</h4>
                <br>
                <p><b>Cargo: </b>{{ candidate.job_role.name }}</p>
                <p><b>Número na urna: </b>{{ candidate.number }}</p>
                <p><b>Partido: </b>{{ candidate.political_party.name }} - {{ candidate.political_party.number }}</p>
                <p><b>Coligação: </b>{{ candidate.coalition }}</p>
                <p><b>Eleita em 2012: </b>{% if candidate.elected == True %} Sim {% else %} Não {% endif %}</p>
                <p><b>Reeleição: </b>{% if candidate.reelection == True %} Sim {% else %} Não {% endif %}</p>
            </div>
        </div>
    </div>
</div>

<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
Enviar comentário
</button>

{% if comments %}
    <h2>Comentários</h2>
    <br>
    <ul class="list-group">
        {% for comment in comments %}
            <li class="list-group-item">
                <h4 class="list-group-item-heading">{{ comment.name }} <small>{{ comment.email }}</small></h4>
                <p class="list-group-item-text">{{ comment.comment }}</p>
            </li>
        {% endfor %}
    </ul>
{% endif %}

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Enviar comentário</h4>
            </div>
            <div class="modal-body">
                <form id="contact_form" method="get" action=".">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_name" class="control-label">Nome:</label>
                        <input type="text" class="form-control" name="name" id="id_name">
                    </div>
                    <div class="form-group">
                        <label for="id_email" class="control-label">Email:</label>
                        <input type="text" class="form-control" name="email" id="id_email">
                    </div>
                    <div class="form-group">
                        <label for="id_comment" class="control-label">Comentário:</label>
                        <textarea class="form-control" id="id_comment" name="comment"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
                <button type="submit" class="btn btn-primary" id="submit_form">Enviar</button>
            </div>
        </div>
    </div>
</div>

{% endblock content %}


{% block js %}

<script>
$(document).ready(function () {
    $("#contact_form").on("submit", function(e) {
        var postData = $(this).serializeArray();
        var formURL = $(this).attr("action");
        $.ajax({
            url: formURL,
            type: "POST",
            data: postData,
            success: function(data, textStatus, jqXHR) {
                $('#contact_dialog .modal-header .modal-title').html("Result");
                $('#contact_dialog .modal-body').html(data);
                $("#submit_form").remove();
            },
            error: function(jqXHR, status, error) {
                console.log(status + ": " + error);
            }
        });
        e.preventDefault();
    });
     
    $("#submit_form").on('click', function() {
        $("#contact_form").submit();
    });
});
</script>

{% endblock js %}